<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>在Docker中构建GitBook并整合GitLab Runner的使用经验分享 - 飞狐的部落格</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Rosen Lu" /><meta name="description" content="简要介绍如何通过Docker创建GitBook并通过GitLab Runner实现GitBook文档内容的自动更新" /><meta name="keywords" content="docker, gitbook" />






<meta name="generator" content="Hugo 0.126.1 with theme even" />


<link rel="canonical" href="https://lucumt.info/post/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.73db591f2a62e178a7e21e92549934d42e8d734d4150222e6eddc38d7961af87.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:url" content="https://lucumt.info/post/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/">
  <meta property="og:site_name" content="飞狐的部落格">
  <meta property="og:title" content="在Docker中构建GitBook并整合GitLab Runner的使用经验分享">
  <meta property="og:description" content="简要介绍如何通过Docker创建GitBook并通过GitLab Runner实现GitBook文档内容的自动更新">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2023-10-07T10:14:02+08:00">
    <meta property="article:modified_time" content="2023-10-07T10:14:02+08:00">
    <meta property="article:tag" content="Gitbook">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Gitlab-Runner">

  <meta itemprop="name" content="在Docker中构建GitBook并整合GitLab Runner的使用经验分享">
  <meta itemprop="description" content="简要介绍如何通过Docker创建GitBook并通过GitLab Runner实现GitBook文档内容的自动更新">
  <meta itemprop="datePublished" content="2023-10-07T10:14:02+08:00">
  <meta itemprop="dateModified" content="2023-10-07T10:14:02+08:00">
  <meta itemprop="wordCount" content="6735">
  <meta itemprop="keywords" content="docker,gitbook">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="在Docker中构建GitBook并整合GitLab Runner的使用经验分享">
  <meta name="twitter:description" content="简要介绍如何通过Docker创建GitBook并通过GitLab Runner实现GitBook文档内容的自动更新">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism-solarizedlight.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-highlight/prism-line-highlight.min.css" integrity="sha512-nXlJLUeqPMp1Q3+Bd8Qds8tXeRVQscMscwysJm821C++9w6WtsFbJjPenZ8cQVMXyqSAismveQJc0C1splFDCA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.css" integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag/ihH7lzuGlGHpDBymLirZQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />



</head>
<body>

  
	  
	  
	  <a href="https://github.com/lucumt/ghblog" title="https://github.com/lucumt/ghblog" target="_blank">  
	  <img style="position: fixed; top: 0; right: 0; border: 0; z-index:9999;" 
		 src="/blog_img/forkme_right_gray.png" 
		 alt="Fork me on GitHub">
	  </a>
  


  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Rosen&#39;s World</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于我</li>
      </a><a href="https://tech.lucumt.info">
        <li class="mobile-menu-item">外链</li>
      </a><a href="/search/">
        <li class="mobile-menu-item">搜索</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Rosen&#39;s World</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于我</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://tech.lucumt.info">外链</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/search/">搜索</a>
      </li>
  </ul>
</nav>

    </header>

    
    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">在Docker中构建GitBook并整合GitLab Runner的使用经验分享</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-10-07 </span>
        <div class="post-category">
            <a href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"> 工具使用 </a>
            <a href="/categories/%E5%AE%B9%E5%99%A8%E5%8C%96/"> 容器化 </a>
            </div>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#背景">背景</a>
      <ul>
        <li><a href="#技术选型">技术选型</a></li>
        <li><a href="#使用流程">使用流程</a></li>
      </ul>
    </li>
    <li><a href="#环境搭建">环境搭建</a>
      <ul>
        <li><a href="#相关说明">相关说明</a></li>
        <li><a href="#操作流程">操作流程</a></li>
        <li><a href="#测试验证">测试验证</a>
          <ul>
            <li><a href="#自动构建">自动构建</a></li>
            <li><a href="#手工构建">手工构建</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#插件管理">插件管理</a>
      <ul>
        <li><a href="#常用插件">常用插件</a></li>
        <li><a href="#自定义插件">自定义插件</a></li>
      </ul>
    </li>
    <li><a href="#其它设置">其它设置</a>
      <ul>
        <li><a href="#中文汉化">中文汉化</a></li>
        <li><a href="#自定义目录">自定义目录</a></li>
        <li><a href="#自定义样式">自定义样式</a></li>
      </ul>
    </li>
    <li><a href="#使用展示">使用展示</a></li>
    <li><a href="#文件脚本">文件&amp;脚本</a>
      <ul>
        <li><a href="#dockerfile脚本">Dockerfile脚本</a></li>
        <li><a href="#docker启停脚本">docker启停脚本</a></li>
        <li><a href="#自动构建脚本">自动构建脚本</a></li>
        <li><a href="#自动注册脚本">自动注册脚本</a></li>
        <li><a href="#自动生成目录">自动生成目录</a>
          <ul>
            <li><a href="#目录分类显示">目录分类显示</a></li>
          </ul>
        </li>
        <li><a href="#自定义样式-1">自定义样式</a></li>
        <li><a href="#gitbook配置文件">GitBook配置文件</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
	 
	  	
	
    <div class="post-content image-border">
	 <p>由于<code>Docsify</code>采用单页渲染的方式，在初次打开是特别慢，近期将团队内部的知识库工具从<code>Docsify</code>迁移到基于<code>Docker</code>搭建的<code>GitBook</code>并结合<code>GitLab Runner</code>实现自动更新，在这其中踩了一些坑，简单记录下。</p>
<h1 id="背景">背景</h1>
<h2 id="技术选型">技术选型</h2>
<p>由于<code>Docsify</code>采用<a href="https://en.wikipedia.org/wiki/Single-page_application"><strong>SPA</strong></a>模式开发，不会生成静态<code>HTML</code>页面，故随着内容与页面的增多，其初次加载时会花费较多时间进行全局渲染，导致显示很慢，浪费时间等于谋财害命，需要将其替换为其它框架！</p>
<p>由于知识库的使用群体除了软件开发人员，还有产品设计师、测试工程师等不具备很强代码开发能力的群体，故在替换之前对要采用的新框架确定了如下目标：</p>
<ul>
<li>采用静态页面生成，避免每次浏览时都需要耗时渲染</li>
<li>采用纯<code>Markdown</code>语法，避免额外的学习与使用成本</li>
<li>界面美观，适合做文档展示，无须做过多配置</li>
<li>插件生态丰富，无须自己额外开发太多的插件</li>
</ul>
<p>基于网络上的资料，初步选定<code>Docsify</code>、<code>GitBook</code>、<code>Hexo</code>和<code>Hugo</code>这4种框架，基于实际使用需求对它们进行对比如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>开发语言</th>
<th>构建速度</th>
<th>展示方式</th>
<th>格式要求</th>
<th>文档 / 社区</th>
<th>目录生成</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Docsify</strong></td>
<td><code>Vue</code></td>
<td>一般</td>
<td>单页面渲染</td>
<td>无</td>
<td>一般</td>
<td>可通过插件自动生成</td>
<td>环境安装简单</td>
<td>初次打开加载很慢</td>
</tr>
<tr>
<td><strong>GitBook</strong></td>
<td><code>Node.js</code></td>
<td>一般</td>
<td>静态页面</td>
<td>无</td>
<td>一般</td>
<td>需自己在<code>SUMMARY.md</code>中生成</td>
<td>样式美观，专门用于做文档管理</td>
<td>官方专注于付费版，非付费版bug较多</td>
</tr>
<tr>
<td><strong>Hexo</strong></td>
<td><code>Node.js</code></td>
<td>一般</td>
<td>静态页面</td>
<td>需添加日期、标题等信息</td>
<td>丰富</td>
<td>依赖于所选的主题</td>
<td>社区活跃，使用度很高</td>
<td>编译速度慢，主要适合做博客</td>
</tr>
<tr>
<td><strong>Hugo</strong></td>
<td><code>Golang</code></td>
<td>快</td>
<td>静态页面</td>
<td>需添加日期、标题等信息</td>
<td>丰富</td>
<td>依赖于所选的主题</td>
<td>构建速度快，使用度很高</td>
<td>文档不完善，主要适合做博客</td>
</tr>
</tbody>
</table>
<p>基于上述对比，可发现虽然<code>Hugo</code>的构建速度最快，但适合做博客，对于知识库这种文档系统不是特别合适，而<code>GitBook</code>虽然构建速度没有<code>Hugo</code>快，但<code>GitBook</code>更侧重于浏览，其构建只会在文档内容有更新时才发生，频率相对较小，同时<code>GitBook</code>从名字上即可看出是专门用于知识库文档管理的，综合考虑下决定采用<code>GitBook</code>来替换<code>Docsify</code>。</p>
<p>同时为了降低<code>GitBook</code>的侵入性，指定如下规则：</p>
<ol>
<li><code>GitLab Runner</code>和<code>Nginx</code>采用<code>Docker</code>进行容器化部署，避免对部署环境的强依赖</li>
<li>通过<code>Docker</code>在<code>GitLab Runner</code>中安装<code>GitBook</code>环境，使得实际的文档项目与<code>GitBook</code>解耦</li>
</ol>
<h2 id="使用流程">使用流程</h2>
<p>由于文档同代码一样都是采用<code>GitLab</code>管理的，为了实现在文档更新时能够自动化的部署，准备采用<code>GitLab Runner</code>+<code>GitBook</code>+<code>Nginx</code>的方案，整体流程图如下：</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-gitlab-usage-flow.png" alt="GitBook结合GitLab Runner使用流程" title="GitBook结合GitLab Runner使用流程"></p>
<p>在实际使用时，相关用户只需要在按照常规的流程在本地基于<code>Markdown</code>格式编写文档并提交到<code>GitLab</code>中，之后<code>GitLab Runner</code>会自动化的进行文档构建与文档生成，依赖于宿主物理机的配置和文档数量，整个过程通常不超过5秒钟，之后在浏览器中刷新即可查看生成的<code>HTML</code>静态文件。</p>
<h1 id="环境搭建">环境搭建</h1>
<h2 id="相关说明">相关说明</h2>
<p>出于简化使用流程与加快构建速度的考虑，将<code>GitLab Runner</code>与<code>GitBook</code>都放置到同一个容器中。在<code>GitLab Runner</code>的<code>Docker</code>容器中安装完毕<code>GitBook</code>环境后，还需将<code>GitLab Runner</code>注册到对应的<code>GitLab</code>仓库中，可通过<code>Shell</code>脚本将此过程固化下来，整个环境搭建流程如下：</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-install-flow.png" alt="GitBook安装流程" title="GitBook安装"></p>
<p><strong>说明</strong>：由于<code>GitBook</code>是基于<code>Nodejs</code>开发的，而<code>Nodejs</code>和<code>NPM</code>对版本有强相关的依赖，版本过高或过低都会导致<code>GitBook</code>以及相关的插件无法安装，故本次采用了如下<strong>较旧的版本</strong>(采用<code>Docker</code>容器化部署不会造成额外的负面影响 )</p>
<table>
<thead>
<tr>
<th></th>
<th>版本</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>GitLab Runner</strong></td>
<td><code>gitlab/gitlab-runner:v15.5.2</code></td>
<td></td>
</tr>
<tr>
<td><strong>GitBook Cli</strong></td>
<td><code>gitbook-cli@2.1.2</code></td>
<td>若版本不对，会导致依赖问题，请参见<a href="https://stackoverflow.com/questions/64211386/gitbook-cli-install-error-typeerror-cb-apply-is-not-a-function-inside-graceful"><strong>Gitbook-cli install error TypeError: cb.apply is not a function inside graceful-fs</strong></a></td>
</tr>
<tr>
<td><strong>GitBook</strong></td>
<td><code>3.2.3</code></td>
<td></td>
</tr>
<tr>
<td><strong>Nodejs</strong></td>
<td><code>v12.22.12</code></td>
<td></td>
</tr>
<tr>
<td><strong>NPM</strong></td>
<td><code>7.5.2</code></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="操作流程">操作流程</h2>
<p>下述步骤展示了从头开始构建<code>GitLab Runner</code>与<code>GitBook</code>的过程</p>
<ol>
<li>
<p>在宿主机上执行如下指令安装<a href="https://github.com/jqlang/jq"><strong>jq</strong></a>指令，后续会用其来解析<code>GitLab</code>中返回的<code>JSON</code>数据</p>

<pre class="line-numbers language-bash ">
<code># 在宿主机上安装jq，用于解析json文件
apt install -y jq</code>
</pre>
</li>
<li>
<p>安装之前请仿照下图将本文最后的<a href="#%E6%96%87%E4%BB%B6%E8%84%9A%E6%9C%AC"><strong>文件&amp;脚本</strong></a></p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-build-file-folder.png" alt="GitBook镜像构建前准备" title="GitBook镜像构建前准备"></p>
</li>
<li>
<p>运行下述指令构建需要的镜像</p>

<pre class="no-line-numbers language-bash ">
<code>docker build -t gitbook_custom:v1.0</code>
</pre>
<p><code>Dockerfile</code>在构建过程中会对它认为没有变化的文件和日志输出进行缓存，要想查看全部日志并取消缓存，可用如下指令</p>

<pre class="no-line-numbers language-bash ">
<code>docker build -t gitbook_custom:v1.0  --progress string . --no-cache</code>
</pre>
</li>
<li>
<p>执行下述指令启动<code>Docker</code>容器并执行相关的初始化操作</p>

<pre class="no-line-numbers language-bash ">
<code>docker-compose down &amp;&amp; docker-compose up -d &amp;&amp; bash gitlab_runner_config_init.sh</code>
</pre>
</li>
<li>
<p>安装过程中会有类似如下输出:</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-install-output-1.png" alt="GitBook安装过程1" title="GitBook安装过程1"></p>
<p>若最后输出结果类似如下，则表示整个脚本安装过程顺利完成</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-install-output-2.png" alt="GitBook安装过程2" title="GitBook安装过程2"></p>
</li>
<li>
<p>在对应<code>GitLab</code>项目中依次点击<code>Settings</code>-&gt;<code>CI/CD</code>-&gt;<code>Runners</code>，若出现类似如下界面则表示<code>GitLab Runner</code>正确安装与配置完毕，接下来即可验证<code>GitBook</code>是否能正常工作</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitlab-runner-register-result.png" alt="GitLab Runner注册结果" title="GitLab Runner注册结果"></p>
</li>
</ol>
<h2 id="测试验证">测试验证</h2>
<h3 id="自动构建">自动构建</h3>
<p>由于<a href="#%E8%87%AA%E5%8A%A8%E6%9E%84%E5%BB%BA%E8%84%9A%E6%9C%AC"><strong>自动构建脚本</strong></a>中有如下配置，其中构建阶段的值被设置为<code>build</code>会导致每次代码发生变更时都执行自动构建</p>

<pre class="line-numbers language-yaml ">
<code>stages:
  - build

# build阶段执行的操作命令 
build:
  stage: build</code>
</pre>
<p>当我们通过<code>git push</code>将代码推送到<code>GitLab</code>后，在对应的<code>GitLab</code>工程中依次点击<code>CI/CD</code>-&gt;<code>Pipelines</code>，会有类似如下输出，可以看到此时<code>GitLab Runner</code>正在执行构建</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitlab-pipeline-running.png" alt="GitLab Runner正在执行" title="GitLab Runner正在执行"></p>
<p>点击对应的按钮可查看构建执行日志，类似如下：</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitlab-pipeline-running-log.png" alt="GitLab Runner执行日志结果" title="GitLab Runner执行日志结果"></p>
<p>之后可通过<code>Nginx</code>对应端口访问相应的<code>GitBook</code>页面，可参考<a href="#%E4%BD%BF%E7%94%A8%E5%B1%95%E7%A4%BA"><strong>使用展示</strong></a>。</p>
<h3 id="手工构建">手工构建</h3>
<p>除了自动构建之外，也可点击对应的按钮进行手工提交，此种场景一般用于文档代码没有变更而对<code>GitBook</code>的样式或插件进行了修改，想提前验证结果，操作步骤如下：</p>
<p>在对应的<code>GitLab</code>工程中依次点击<code>CI/CD</code>-&gt;<code>Pipelines</code>，在出现的菜单中点击右上角的<code>Run pipeline</code>按钮</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitlab-pipeline-run-button.png" alt="GitLab Runner手工触发" title="GitLab Runner手工触发"></p>
<p>在出现的界面中再次点击<code>Run pipeline</code>按钮进行确认，触发手工执行，之后的步骤与自动构建时相同。</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitlab-pipeline-run-confirm-button.png" alt="GitLab Runner手工触发确认" title="GitLab Runner手工触发确认"></p>
<h1 id="插件管理">插件管理</h1>
<p><code>GitBook</code>在文档管理领域广受欢迎的一个很重要的原因是其丰富的插件生态，插件可快速集成，也可仿照别人的插件根据自己的需求快速开发新的插件，个人项目中用到的插件如下</p>
<h2 id="常用插件">常用插件</h2>
<table>
<thead>
<tr>
<th>插件</th>
<th>作用</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/gitbook-plugin-fox/gitbook-plugin-prism-codetab-fox"><strong>gitbook-plugin-prism-codetab-fox</strong></a></td>
<td>对代码采用<a href="https://prismjs.com/"><strong>Prims.js</strong></a>进行高亮，同时可根据需求对代码进行分组</td>
<td>需要在<code>book.js</code>中通过 <code>-highlight</code>的方式屏蔽默认的高亮插件</td>
</tr>
<tr>
<td><a href="https://github.com/gitbook-plugin-fox/gitbook-plugin-mermaid-fox"><strong>gitbook-plugin-mermaid-fox</strong></a></td>
<td>支持<a href="https://mermaid.js.org/"><strong>Mermaid</strong></a>图表功能</td>
<td>实际使用过程中发现部分图表无法展示</td>
</tr>
<tr>
<td><a href="https://github.com/gitbook-plugin-fox/gitbook-plugin-flowchart-fox"><strong>gitbook-plugin-flowchart-fox</strong></a></td>
<td>用于支持<a href="https://flowchart.js.org/"><strong>flowchart</strong></a>图表</td>
<td>实际使用过程中发现该插件bug较多，在组件过多时会出现样式混乱</td>
</tr>
<tr>
<td><a href="https://github.com/codeclou/gitbook-plugin-advanced-emoji"><strong>gitbook-plugin-advanced-emoji</strong></a></td>
<td>用于展示<a href="https://getemoji.com/"><strong>Emoji</strong></a>表情</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/csbun/gitbook-plugin-chart#readme"><strong>gitbook-plugin-chart</strong></a></td>
<td>利用<a href="http://c3js.org/"><strong>C3.js</strong></a>或<a href="http://www.highcharts.com/"><strong>Highcharts</strong></a>来展示图表</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/somax/gitbook-plugin-popup"><strong>gitbook-plugin-popup</strong></a></td>
<td>在新窗口中打开图片</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/artalar/gitbook-plugin-accordion/"><strong>gitbook-plugin-accordion</strong></a></td>
<td>手风琴插件，用于展开或折叠相关内容</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/GitbookIO/plugin-katex"><strong>plugin-katex</strong></a></td>
<td>支持基于<a href="https://katex.org/"><strong>KaTeX</strong></a>的数学公式展示</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/gitbook-plugins/gitbook-plugin-search-pro"><strong>gitbook-plugin-search-pro</strong></a></td>
<td>支持中文搜索的插件</td>
<td>需要在<code>book.js</code>中通过 <code>-search</code>的方式屏蔽默认的搜索插件<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></td>
</tr>
<tr>
<td><a href="https://github.com/gonjay/gitbook-plugin-hide-element"><strong>gitbook-plugin-hide-element</strong></a></td>
<td>隐藏特定元素</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/ColinCollins/gitbook-plugin-chapter-fold"><strong>gitbook-plugin-chapter-fold</strong></a></td>
<td>页面上方的导航目录折叠</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/davidmogar/gitbook-plugin-code"><strong>gitbook-plugin-code</strong></a></td>
<td>给代码块添加行号与复制按钮</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/yoshidax/gitbook-plugin-splitter"><strong>gitbook-plugin-splitter</strong></a></td>
<td>页面左侧的侧边栏可动态调节</td>
<td>该插件与<code>xmind</code>插件一并使用时会导致后者无法正常使用</td>
</tr>
<tr>
<td><a href="https://github.com/cjdbarlow/gitbook-plugin-expandable-chapters-small"><strong>gitbook-plugin-expandable-chapters-small</strong></a></td>
<td>页面右侧的目录可展开或收缩</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/FastGitORG/gitbook-plugin-tbfed-pagefooter"><strong>gitbook-plugin-tbfed-pagefooter</strong></a></td>
<td>页面显示定制化的页脚信息</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/thomas88100/gitbook-plugin-ancre-navigation"><strong>gitbook-plugin-ancre-navigation</strong></a></td>
<td>页内导航回到顶部</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/GitbookIO/plugin-sharing"><strong>gitbook-plugin-sharing</strong></a></td>
<td>将特定页面分享到其它平台的按钮插件</td>
<td>需要在<code>book.js</code>中通过 <code>-sharing</code>的方式屏蔽默认的分享插件</td>
</tr>
<tr>
<td><a href="https://plugins.gitbook.com/plugin/theme-comscore"><strong>gitbook-plugin-theme-comscore</strong></a></td>
<td><code>GitBook</code>彩色主题</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/menduo/gitbook-plugin-favicon"><strong>gitbook-plugin-favicon</strong></a></td>
<td>添加favicon图标</td>
<td></td>
</tr>
<tr>
<td><a href="https://github.com/fzankl/gitbook-plugin-flexible-alerts"><strong>gitbook-plugin-flexible-alerts</strong></a></td>
<td>自定义的提示说明样式</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="自定义插件">自定义插件</h2>
<p>已有的插件太老旧，自己<code>fork</code>代码后对它们进行了更新，项目位于<a href="https://github.com/gitbook-plugin-fox"><strong>gitbook-plugin-fox</strong></a>，目前包含如下插件：</p>
<ul>
<li>
<p><a href="https://github.com/gitbook-plugin-fox/gitbook-plugin-mermaid-fox"><strong>gitbook-plugin-mermaid-fox</strong></a>，<code>GitBook</code>中支持新版的<a href="https://flowchart.js.org/"><strong>flowchart.js</strong></a>图表，展示效果如下</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-flowchart-chart-display.png" alt="GitBook中展示Flowchart图表" title="GitBook中展示Flowchart图表"></p>
</li>
<li>
<p><a href="https://github.com/gitbook-plugin-fox/gitbook-plugin-mermaid-fox"><strong>gitbook-plugin-mermaid-fox</strong></a>，<code>GitBook</code>中支持新版的<a href="https://mermaid.js.org/"><strong>Mermaid</strong></a>图表，展示效果如下</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-mermaid-chart-display.png" alt="GitBook中展示Mermaid图表" title="GitBook中展示Mermaid图表"></p>
</li>
<li>
<p><a href="https://github.com/gitbook-plugin-fox/gitbook-plugin-prism-codetab-fox"><strong>gitbook-plugin-prism-codetab-fox</strong></a>，将<a href="https://github.com/gaearon/gitbook-plugin-prism"><strong>gitbook-plugin-prism</strong></a>与<a href="https://github.com/GitbookIO/plugin-codetabs"><strong>gitbook-plugin-codetabs</strong></a>这两个插件整合为一个插件，在实现代码高亮的同时还能对代码进行分组，展示效果如下：</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-codetab-fox-display.png" alt="GitBook中展示代码分组" title="GitBook中展示代码分组"></p>
</li>
</ul>
<h1 id="其它设置">其它设置</h1>
<h2 id="中文汉化">中文汉化</h2>
<p><code>GitBook</code>中的默认语言为英文，如下图所示，某些提示信息以英文展示，不方便使用</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-default-en-language.png" alt="GitBook默认英文展示" title="GitBook默认英文展示"></p>
<p>可通过在<code>book.js</code>中添加<code>language:'zh-hans'</code>来将默认语言修改为中文，修改后的显示效果如下：</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-set-zh-language.png" alt="GitBook切换为中文显示" title="GitBook切换为中文显示"></p>
<h2 id="自定义目录">自定义目录</h2>
<p>如下所示<code>GitBook</code>中默认生成的菜单为<code>Introduction</code>，不太直观，可根据实际需求动态修改(对于菜单目录的生成可参考<a href="#%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E7%9B%AE%E5%BD%95"><strong>自动生成目录</strong></a>实现)</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-default-menu.png" alt="GitBook默认菜单展示" title="GitBook默认菜单展示"></p>
<p>将默认目录从</p>

<pre class="no-line-numbers language-markdown ">
<code>* [Introduction](README.md)</code>
</pre>
<p>修改为</p>

<pre class="no-line-numbers language-markdown ">
<code>* [概览](README.md)</code>
</pre>
<p>之后的展示效果类似如下</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-custom-menu.png" alt="GitBook自定义菜单展示" title="GitBook自定义菜单展示"></p>
<h2 id="自定义样式">自定义样式</h2>
<p>若<code>GitBook</code>中的样式不满足我们的需求，可通过添加自定义<code>CSS</code>文件进行定制，实际使用中发现该文件必须叫做<code>website.css</code>且需位于生成的静态文件目录下才生效。</p>

<pre class="line-numbers language-json ">
<code>&#34;styles&#34;: {
    &#34;website&#34;: &#34;./styles/website.css&#34;,
}</code>
</pre>
<h1 id="使用展示">使用展示</h1>
<p>可通过<code>Nginx</code>对应端口访问相应的<code>GitBook</code>页面，个人项目中的界面类似如下，供参考</p>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-web-page-view.png" alt="GitBook页面浏览" title="GitBook页面浏览"></p>
<h1 id="文件脚本">文件&amp;脚本</h1>
<h2 id="dockerfile脚本">Dockerfile脚本</h2>
<p>用于构建同时包含<code>GitLab Runner</code>与<code>GitBook</code>的容器</p>

<pre class="line-numbers language-dockerfile ">
<code>FROM gitlab/gitlab-runner:v15.5.2

# 更改为公司内部的镜像源
RUN rm -rf /etc/apt/sources.list &amp;&amp; touch /etc/apt/sources.list

RUN echo &#39;deb [trusted=yes] https://mirrors.xxx.com/repository/Debian/ bullseye main non-free contrib&#39; &gt;&gt; /etc/apt/sources.list
RUN echo &#39;deb-src [trusted=yes] https://mirrors.xxx.com/repository/Debian/ bullseye main non-free contrib&#39; &gt;&gt; /etc/apt/sources.list
RUN echo &#39;deb [trusted=yes] https://mirrors.xxx.com/repository/Debian/ bullseye-updates main non-free contrib&#39; &gt;&gt; /etc/apt/sources.list
RUN echo &#39;deb-src [trusted=yes] https://mirrors.xxx.com/repository/Debian/ bullseye-updates main non-free contrib&#39; &gt;&gt; /etc/apt/sources.list
RUN echo &#39;deb [trusted=yes] https://mirrors.xxx.com/repository/Debian/ bullseye-backports main non-free contrib&#39; &gt;&gt; /etc/apt/sources.list
RUN echo &#39;deb-src [trusted=yes] https://mirrors.xxx.com/repository/Debian/ bullseye-backports main non-free contrib&#39; &gt;&gt; /etc/apt/sources.list

# 安装nodejs
RUN apt-get update -y

RUN apt-get install nodejs npm -y
RUN npm cache clean --force
RUN npm config set registry https://mirrors.xxx.com/repository/NPM/
RUN npm install -g gitbook-cli@2.1.2

RUN mkdir -p /usr/local/gitbook/data
RUN mkdir -p /usr/local/gitbook/tmp/docs
RUN chown -R gitlab-runner:gitlab-runner /usr/local/gitbook/tmp
COPY book.js /usr/local/gitbook/tmp/book.js
COPY custom.css /usr/local/gitbook/tmp/custom.css
COPY favicon.ico /usr/local/gitbook/tmp/favicon.ico
COPY auto_generate_summary.sh /usr/local/gitbook/auto_generate_summary.sh</code>
</pre>
<h2 id="docker启停脚本">docker启停脚本</h2>
<p><code>docker-compose.yml</code>用于启动<code>GitLab Runner</code>与<code>Nginx</code>容器</p>

<pre class="line-numbers language-yaml ">
<code>version: &#34;3&#34;
services:
 gitbook:
   privileged: true
   image: gitbook_custom:v1.0
   volumes:
     - $PWD/data:/usr/local/gitbook/data:rw
   restart: always
   container_name: gitbook-custom
 nginx:
   privileged: true
   image: nginx:1.22
   ports:
     - &#34;3000:80&#34;
   volumes:
     - $PWD/data:/usr/share/nginx/html
   restart: always
   container_name: gitbook-nginx</code>
</pre>
<h2 id="自动构建脚本">自动构建脚本</h2>
<p><code>.gitlab-ci.yml</code>是<code>GitLab Runner</code>构建时使用的文件，此文件规定了构建过程中要具体执行的步骤，只有此文件必须存在于目标文档对应的<code>GitLab</code>仓库，用于每次修改文档时触发自动构建</p>

<pre class="line-numbers language-yaml ">
<code>variables:
  # 是否自动生成目录
  AUTO_SUMMARY: &#34;true&#34;

# 定义ci/cd 执行build流程
stages:
  - build

# build阶段执行的操作命令 
build:
  stage: build
  tags:
    - xxx-doc
  script:
    - echo &#34;======== start build ========&#34;
    - rm -rf /usr/local/gitbook/tmp/docs/*
    - cp -r * /usr/local/gitbook/tmp/docs/
    - mkdir -p /usr/local/gitbook/tmp/docs/styles
    - cd /usr/local/gitbook/tmp
    - cp custom.css  /usr/local/gitbook/tmp/docs/styles/website.css
    - bash /usr/local/gitbook/auto_generate_summary.sh $PWD
    - gitbook build
    - rm -rf /usr/local/gitbook/data/*
    - cp -r /usr/local/gitbook/tmp/_book/*  /usr/local/gitbook/data/
    - cp -rf /usr/local/gitbook/tmp/favicon.ico  /usr/local/gitbook/data/gitbook/images/favicon.ico</code>
</pre>
<h2 id="自动注册脚本">自动注册脚本</h2>
<p><code>gitlab_runner_config_init.sh</code>用于注册<code>GitLab Runner</code>同时检测<code>GitBook</code>是否存在</p>

<pre class="line-numbers language-bash ">
<code>#/bin/bash

#更新文件权限

FOLDER=&#34;/usr/local/gitbook/data&#34;
docker exec -it gitbook-custom bash -c &#34;chown -R gitlab-runner:gitlab-runner $FOLDER&#34;
echo &#34;===================完成$FOLDER数据目录权限修改=====================&#34;


# 删除gitlab runner
GITLAB_URL=&#39;http://aeectss.xxx.local:1800/&#39;
echo &#39;===================开始删除旧的gitlab runner=====================&#39;
PRIVATE_TOKEN=&#39;5JZxxYzapBB_zfze5c2_&#39;
PROJECT_ID=57
ids=$(curl --header &#34;PRIVATE-TOKEN:${PRIVATE_TOKEN}&#34; &#34;${GITLAB_URL}/api/v4/runners&#34;  |jq -r &#39;.[]|&#34;\(.id)&#34;&#39;)
for id in $ids; do
  eval &#34;curl --request DELETE --header &#39;PRIVATE-TOKEN:${PRIVATE_TOKEN}&#39; &#39;${GITLAB_URL}/api/v4/runners/${id}&#39;&#34;
  printf &#34;\033[32m=====================删除id为${id}的runner======================\033[0m\n&#34;
done


# 注册gitlab runner
CUR_DATE=$(date &#34;&#43;%Y-%m-%d %H:%M:%S&#34;)
TOKEN=&#39;M9VwuFfu9E42mb5QRx7M&#39;
TAG_LIST=&#39;xxxxx-doc&#39;
DESC=&#39;xxxxx文档撰写&#39;
echo &#39;===================开始注册gitlab runner=====================&#39;
sudo docker exec -it gitbook-custom \
gitlab-runner register --non-interactive \
--url &#34;${GITLAB_URL}&#34;  \
--registration-token &#34;${TOKEN}&#34; \
       --executor &#34;shell&#34; \
       --tag-list &#34;${TAG_LIST}&#34; \
--description &#34;${DESC} -- 添加时间:${CUR_DATE}&#34;


# 安装gitbook
echo &#39;===================开始检查gitbook=====================&#39;
check=$(docker exec -it --user gitlab-runner gitbook-custom gitbook ls)

if [[ $check == *&#34;no versions installed&#34;* ]]; then
  echo &#34;gitbook在gitlab-runner用户下没有安装&#34;
  command=&#34;npm config set registry https://mirrors.xxx.com/repository/NPM/&#34;
  command=&#34;${command};gitbook fetch&#34;
  command=&#34;${command};cd /usr/local/gitbook/tmp&#34;
  command=&#34;${command};npm install gitbook-plugin-mermaid-fox&#34;
  command=&#34;${command};gitbook install&#34;
  #command=&#34;${command};cp /usr/local/gitbook/tmp/node_modules/prismjs/components/prism-docker.js /usr/local/gitbook/tmp/node_modules/prismjs/components/prism-dockerfile.js&#34;
  command=&#34;docker exec -it --user gitlab-runner gitbook-custom bash -c &#39;$command&#39;&#34;
  echo &#34;=========================要执行的命令=======================&#34;
  printf &#34;\033[32m${command}\033[0m\n&#34;
  echo &#34;============================================================&#34;
  eval $command
else
  printf &#34;\033[32mGitbook已经安装，相关检查结果如下:\033[0m\n&#34;
  echo &#34;$check&#34;
fi

printf &#34;\033[32m===================gitlab runner初始化完毕!=====================\033[0m\n&#34;</code>
</pre>
<h2 id="自动生成目录">自动生成目录</h2>
<p><code>auto_generate_summary.sh</code>用于自动生成目录，<code>GitBook</code>左侧的目录树依赖于此脚本的生成结果，此文件会在<code>GitLab Runner</code>构建阶段执行</p>

<pre class="line-numbers language-bash ">
<code>#!/bin/bash
# 先清空文件
echo &#34;&#34; &gt;  docs/SUMMARY.md
# 子文件夹读取的递归函数
dirReader(){
    # $1 文件绝对路径
    # $2 章节名称
    # $3 缩进
    # 循环处理该文件夹下的文件
    for item in &#34;${1}&#34;/*
    do
        # 判断是否是文件夹且不是图片文件夹
        if [ -d &#34;$item&#34; ]  &amp;&amp;  ! [[ &#34;${item}&#34; =~ assets$ ]]
        then
            # 判断该文件夹是否存在README.md文件
            if [ ! -f &#34;$item/README.md&#34; ]
            then 
                # 如果没有就创建README.md
                echo &#34;&#34; &gt; &#34;$item/README.md&#34;
            fi
            # 获取文件名称
            beginPos=`expr ${#1} &#43; 1`
            endPos=`expr ${#item} - ${#1}`
            dirName=${item:$beginPos:$endPos}
            echo ${item}
            # 写入目录文件
            echo &#34;$3&#43; [$dirName]($2/$dirName/README.md)&#34; &gt;&gt; docs/SUMMARY.md
            # 递归处理该文件夹
            dirReader &#34;$item&#34; &#34;$2/$dirName&#34; &#34;$3  &#34;
        # 判断该文件是否是.md结尾 并且不是README.md
        elif [ -f &#34;$item&#34; ] &amp;&amp; [ &#34;${item##*.}&#34; == &#39;md&#39; ] 
        then
            beginPos=`expr ${#1} &#43; 1`
            endPos=`expr ${#item} - ${#1} - 4`
            dirName=${item:$beginPos:$endPos}
            # 写入目录文件
            if[ &#34;$dirName&#34; != &#39;README&#39; ]
            then
                echo ${item}
                echo &#34;$3&#43; [$dirName]($2/$dirName.md)&#34; &gt;&gt; docs/SUMMARY.md
            fi
        fi
    done
}
# 读取当前路径
dirs=&#34;${PWD}/docs/&#34;
echo &#34;- [主页](README.md)&#34; &gt;  docs/SUMMARY.md
# 循环处理该文件夹下的文件dir
for dir in docs/*
do
    # 截取掉dir路径名称里的 docs/
    startPos=&#39;5&#39;
    length=`expr ${#dir} - 5`
    dir=${dir:$startPos:$length}
    # 判断是否是文件夹且不是图片文件夹
    if [ -d &#34;${dirs}/${dir}&#34; ] &amp;&amp; ! [[ &#34;${dir}&#34; =~ assets$ ]] &amp;&amp; ! [[ &#34;${dir}&#34; =~ styles$ ]] 
    then 
        # 判断该文件夹是否存在README.md文件
        if [ ! -f &#34;$dirs/$dir/README.md&#34; ]
        then 
        	echo &#34;&#34; &gt; &#34;$dirs/$dir/README.md&#34;
        fi
        # 写入目录文件
        echo &#34;&#43; [$dir]($dir/README.md)&#34; &gt;&gt; docs/SUMMARY.md
        # 处理文件夹内部的文件
        dirReader &#34;$dirs$dir&#34; &#34;$dir&#34; &#34;  &#34;
    # 判断该文件是否是.md结尾 并且不是SUMMARY.md 和 README.md
    elif  [ &#34;${dir##*.}&#34; == &#39;md&#39; ] &amp;&amp; [ &#34;${dir}&#34; != &#34;SUMMARY.md&#34; ] &amp;&amp; [ &#34;${dir}&#34; != &#39;README.md&#39; ]
    then
    # 写入目录文件
    	echo &#34;&#43; [$dir]($dir)&#34; &gt;&gt; docs/SUMMARY.md
    fi
done</code>
</pre>
<h3 id="目录分类显示">目录分类显示</h3>
<p><img src="/blog_img/gitbook/using-docker-to-build-gitbook-with-gitlab-runner/gitbook-menu-category.png" alt="GitBook目录分类显示" title="GitBook目录分类显示"></p>
<p>若需要在生成目录时能自动进行如上图所示的分类展示，则可将上述脚本修改为类似如下</p>

<pre class="line-numbers language-bash ">
<code>#!/bin/bash
: &#39;
此脚本用于生成目录时可根据目录类别分成多个子类，要分类的顶层文件夹记录在special_tags数组变量中
&#39;
# 先清空文件
echo &#34;&#34; &gt;  docs/SUMMARY.md
# 子文件夹读取的递归函数
dirReader(){
	# $1 文件绝对路径
	# $2 章节名称
	# $3 缩进
	# 循环处理该文件夹下的文件
	for item in &#34;${1}&#34;/*
	do	
		# 判断是否是文件夹且不是图片文件夹
		if [ -d &#34;$item&#34; ]  &amp;&amp;  ! [[ &#34;${item}&#34; =~ assets$ ]]
		then
			# 判断该文件夹是否存在README.md文件
			if [ ! -f &#34;$item/README.md&#34; ]
			then 
				# 如果没有就创建README.md
				echo &#34;&#34; &gt; &#34;$item/README.md&#34;
			fi
			# 获取文件名称
			beginPos=`expr ${#1} &#43; 1`
			endPos=`expr ${#item} - ${#1}`
			dirName=${item:$beginPos:$endPos}
			echo ${item}
			# 写入目录文件
			echo &#34;$3&#43; [$dirName]($2/$dirName/README.md)&#34; &gt;&gt; docs/SUMMARY.md
			# 递归处理该文件夹
			dirReader &#34;$item&#34; &#34;$2/$dirName&#34; &#34;$3  &#34;
		# 判断该文件是否是.md结尾 并且不是README.md
		elif [ -f &#34;$item&#34; ] &amp;&amp; [ &#34;${item##*.}&#34; == &#39;md&#39; ] 
		then
			beginPos=`expr ${#1} &#43; 1`
			endPos=`expr ${#item} - ${#1} - 4`
			dirName=${item:$beginPos:$endPos}
			# 写入目录文件
			if	[ &#34;$dirName&#34; != &#39;README&#39; ]
			then
				echo ${item}
				echo &#34;$3&#43; [$dirName]($2/$dirName.md)&#34; &gt;&gt; docs/SUMMARY.md
			fi
		fi
	done
}

baseReader(){
    # 需要另外新开一个分类
	special_tags=(&#34;VDE相关&#34; &#34;云授权平台&#34;)
    regex=$(IFS=&#39;|&#39;; echo &#34;${special_tags[*]}&#34;)
	special_dirs=()

	# 读取当前路径
	dirs=&#34;${PWD}/docs/&#34;
	echo &#34;- [主页](README.md)&#34; &gt;  docs/SUMMARY.md
	# 循环处理该文件夹下的文件dir
	for dir in docs/*
	do
		# 截取掉dir路径名称里的 docs/
		startPos=&#39;5&#39;
		length=`expr ${#dir} - 5`
		dir=${dir:$startPos:$length}
		if echo &#34;$dir&#34; | egrep -iq &#34;$regex&#34;  ; then
		   special_dirs&#43;=(&#34;$dir&#34;)
		else
		   baseWrite &#34;$dirs&#34; &#34;$dir&#34;
		fi
	done
	
	# 处理特殊类别的文件
	if [[ -n &#34;$special_dirs&#34; ]]; then
	    echo $&#39;\n#\n&#39; &gt;&gt; docs/SUMMARY.md
	fi
	for dir in &#34;${special_dirs[@]}&#34;; do
	    baseWrite &#34;$dirs&#34; &#34;$dir&#34;
	done 
	
}

baseWrite(){
    dirs=$1
	dir=$2
	# 判断是否是文件夹且不是图片文件夹
	if [ -d &#34;${dirs}/${dir}&#34; ] &amp;&amp; ! [[ &#34;${dir}&#34; =~ assets$ ]] &amp;&amp; ! [[ &#34;${dir}&#34; =~ styles$ ]] 
	then 	
		# 判断该文件夹是否存在README.md文件
		if [ ! -f &#34;$dirs/$dir/README.md&#34; ]
		then 
			echo &#34;&#34; &gt; &#34;$dirs/$dir/README.md&#34;
		fi
		
		# 写入目录文件
		echo &#34;&#43; [$dir]($dir/README.md)&#34; &gt;&gt; docs/SUMMARY.md
		# 处理文件夹内部的文件
		dirReader &#34;$dirs$dir&#34; &#34;$dir&#34; &#34;  &#34;
	# 判断该文件是否是.md结尾 并且不是SUMMARY.md 和 README.md
	elif  [ &#34;${dir##*.}&#34; == &#39;md&#39; ] &amp;&amp; [ &#34;${dir}&#34; != &#34;SUMMARY.md&#34; ] &amp;&amp; [ &#34;${dir}&#34; != &#39;README.md&#39; ]
	then
			# 写入目录文件
			echo &#34;&#43; [$dir]($dir)&#34; &gt;&gt; docs/SUMMARY.md
	fi
}

baseReader</code>
</pre>
<h2 id="自定义样式-1">自定义样式</h2>
<p><code>custom.css</code>是自定义样式文件，当对<code>GitBook</code>的某些样式不满意时，可用自定义<code>CSS</code>文件来覆盖</p>

<pre class="line-numbers language-css ">
<code>.book .book-body .page-wrapper .page-inner {
  max-width: 1200px !important;
}

.markdown-section img:not(.emoji) {
    max-width: 100%;
    border: 1px dashed #a9a4a4;
}

table &gt; thead &gt; tr &gt; th {
   text-align:center !important;
}


.markdown-section code:not([class^=&#34;lang-&#34;]) {
    padding: 3px 5px;
    margin: 0;
    font-size: .85em;
    color: #c7254e;
    border-radius: 4px;
}

small {
    font-size: 80% !important;
}

section  {
    width:100%;
}
h1 {
  color: #2674BA;
}
h2 {
  color: #0099CC;
}
h3 {
  color: #F77A0B;
}
h4 {
  color: #662D91;
}
h5 {
  color: #444444;
}
th {
  background-color: #2674BA;
  color: white;
}</code>
</pre>
<h2 id="gitbook配置文件">GitBook配置文件</h2>
<p><code>book.js</code>是<code>GitBook</code>的配置文件，包含全局配置与各种插件</p>

<pre class="line-numbers language-javascript ">
<code>module.exports = {
    // markdown文档所在路径
    root: &#39;./docs&#39;,
    // 项目标题
    title: &#39;xxxxx平台文档&#39;,
    // 版本
    gitbook: &#39;3.2.3&#39;,
    language: &#39;zh-hans&#39;,
    // 插件
    plugins: [
        &#39;-highlight&#39;,
        &#39;prism-codetab-fox&#39;,
        &#39;advanced-emoji&#39;,
        &#39;mermaid-fox&#39;, // 图表
        &#39;graph&#39;,
        &#39;flowchart-fox&#39;,
        &#39;chart&#39;,
        &#39;popup&#39;,
        &#39;accordion&#39;,
        &#39;katex&#39;,
        &#39;-search&#39;, //搜索
        &#39;search-pro&#39;, //中文搜索
        &#39;hide-element&#39;, //元素隐藏
        &#39;-lunr&#39;, //索引
        &#39;chapter-fold&#39;, //导航目录折叠
        &#39;code&#39;, //代码复制按钮
        &#39;splitter&#39;, //侧边栏宽度可调节
        &#39;expandable-chapters-small&#39;, //目录收起
        &#39;tbfed-pagefooter&#39;, //页面添加页脚
        &#39;ancre-navigation&#39;, //页内导航回到顶部
        &#39;-sharing&#39;, &#39;sharing-plus&#39;, //分享链接
        &#39;theme-comscore&#39;, //主题
        &#39;favicon&#39;, //图标
        &#39;flexible-alerts&#39; // 警告
    ],
    // 插件配置
    pluginsConfig: {
        &#39;prism&#39;: {
            &#39;css&#39;: [
                &#39;prismjs/themes/prism-solarizedlight.css&#39;
            ],
            &#34;lang&#34;: {
                &#34;dockerfile&#34;: &#34;docker&#34;
            },
            &#34;ignore&#34;: [
                &#34;mermaid&#34;,
                &#34;eval-js&#34;
            ]
        },
        &#39;hide-element&#39;: {
            &#39;elements&#39;: [&#39;.gitbook-link&#39;] //需要隐藏的元素，可以通过浏览网页找到该class
        },
        &#39;tbfed-pagefooter&#39;: {
            &#39;copyright&#39;: &#39;Copyright &amp;copy xxx.com 2023-2033&#39;,
            &#39;modify_label&#39;: &#39;修订时间：&#39;,
            &#39;modify_format&#39;: &#39;YYYY-MM-DD HH:mm:ss&#39;
        },
        &#39;sharing&#39;: {
            &#39;all&#39;: []
        },
        &#34;chart&#34;: {
            &#34;type&#34;: &#34;c3&#34;
        },
        &#34;chapter-fold&#34;: {},
        &#34;favicon&#34;: {
            &#34;shortcut&#34;: &#34;/favicon.ico&#34;,
            &#34;bookmark&#34;: &#34;/favicon.ico&#34;
        },
        &#39;flowchart&#39;: {
            &#34;arrow-end&#34;: &#34;block&#34;,
            &#34;element-color&#34;: &#34;black&#34;,
            &#34;fill&#34;: &#34;white&#34;,
            &#34;flowstate&#34;: {
                &#34;approved&#34;: {
                    &#34;fill&#34;: &#34;#58C4A3&#34;,
                    &#34;font-size&#34;: 12
                },
                &#34;current&#34;: {
                    &#34;fill&#34;: &#34;#008080&#34;,
                    &#34;font-color&#34;: &#34;white&#34;,
                    &#34;font-weight&#34;: &#34;bold&#34;
                },
                &#34;future&#34;: {
                    &#34;fill&#34;: &#34;#8A624A&#34;
                },
                &#34;success&#34;: {
                    &#34;fill&#34;: &#34;#0B6623&#34;
                },
                &#34;invalid&#34;: {
                    &#34;fill&#34;: &#34;#6c5696&#34;
                },
                &#34;past&#34;: {
                    &#34;fill&#34;: &#34;#CCCCCC&#34;,
                    &#34;font-size&#34;: 12
                },
                &#34;select&#34;: {
                    &#34;fill&#34;: &#34;#E1AD01&#34;,
                    &#34;font-size&#34;: 12
                },
                &#34;rejected&#34;: {
                    &#34;fill&#34;: &#34;#C45879&#34;,
                    &#34;font-size&#34;: 12
                },
                &#34;request&#34;: {
                    &#34;fill&#34;: &#34;#569656&#34;
                },
                &#39;yellowgreen&#39;: {
                    &#34;fill&#34;: &#34;yellowgreen&#34;
                },
                &#39;failed&#39;: {
                    &#34;fill&#34;: &#34;#800020&#34;
                }
            },
            &#34;font-color&#34;: &#34;black&#34;,
            &#34;font-size&#34;: 14,
            &#34;line-color&#34;: &#34;black&#34;,
            &#34;line-length&#34;: 50,
            &#34;line-width&#34;: 1.3,
            &#34;scale&#34;: 1,
            &#34;symbols&#34;: {
                &#34;end&#34;: {
                    &#34;class&#34;: &#34;end-element&#34;,
                    &#34;font-color&#34;: &#34;white&#34;,
                    &#34;font-weight&#34;: &#34;bold&#34;
                },
                &#34;start&#34;: {
                    &#34;fill&#34;: &#34;#8c2106&#34;,
                    &#34;font-color&#34;: &#34;white&#34;,
                    &#34;font-weight&#34;: &#34;bold&#34;
                }
            },
            &#34;text-margin&#34;: 10,
            &#34;width&#34;: 1,
            &#34;x&#34;: 0,
            &#34;y&#34;: 0,
            &#34;yes-text&#34;: &#34;是&#34;,
            &#34;no-text&#34;: &#34;否&#34;
        }
    },
    variables: {
        &#34;styles&#34;: {
            &#34;website&#34;: &#34;./styles/website.css&#34;,
        }
    }
};</code>
</pre>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>可根据实际要求通过<code>-lunr</code>来屏蔽对应的索引插件&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/gitbook/">gitbook</a>
          <a href="/tags/docker/">docker</a>
          <a href="/tags/gitlab-runner/">gitlab-runner</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/gitbook/gitbook-install-missing-required-argement/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">[非原创]解决Gitbook安装过程中出现的Error: Missing required argument #1错误</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/docsify/enchane-code-highlight-in-docsify/">
            <span class="next-text nav-default">对Docsify中的代码高亮显示进行增强</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://giscus.app/client.js"
            data-repo="lucumt/ghblog"
            data-repo-id="MDEwOlJlcG9zaXRvcnk0MTQ3MDEzOA=="
            data-category="General"
            data-category-id="DIC_kwDOAnjIus4CRN6c"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="light"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/giscus/giscus">comments powered by giscus.</a></noscript>

      </div>
    </main>
	

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:cumtlu@126.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/3176419" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://www.linkedin.com/in/%E8%BF%90%E5%BC%BA-%E5%8D%A2-50a08bb5/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/lucumt" class="iconfont icon-github" title="github"></a>
  <a href="" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2016 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top" title="回到顶部">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.6.4.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>


<script src="/lib/flowchartDiagrams/raphael-2.2.7.min.js"></script>
    <script src="/lib/flowchartDiagrams/flowchart-1.8.0.min.js"></script><script>
	   
	
	
	let flowPageOptions = "{ 'x': 0, 'y': 10, 'width':1, 'yes-text': 'yes', 'no-text': 'no', 'line-width': 1.3, 'line-length': 30, 'text-margin': 10, 'font-size': 15, 'font-color': 'black', 'line-color': 'black', 'element-color': 'black', 'fill': 'white', 'arrow-end': 'block', 'font-weight': 'bold', 'font-color': 'white', 'scale': 0.8, 'symbols': { }, 'flowstate': { 'approved': { 'fill': '#58C4A3', 'font-size': 12 }, 'current': { 'fill': '#008080', 'font-color': 'white', 'font-weight': 'bold' }, 'future': { 'fill': '#8A624A' }, 'success': { 'fill': '#0B6623', 'font-color': 'white', 'font-weight': 'bold' }, 'invalid': { 'fill': '#6c5696' }, 'past': { 'fill': '#CCCCCC', 'font-size': 12 }, 'select': { 'fill': '#E1AD01', 'font-size': 12, 'yes-text': '是', 'no-text': '否' }, 'rejected': { 'fill': '#C45879', 'font-size': 12 }, 'request': { 'fill': '#569656' }, 'yellowgreen':{ 'fill': 'yellowgreen' }, 'failed':{ 'fill': '#800020' }, 'approved': {'fill': 'peru'} } }";
	let flowSiteOptions = "";
	flowPageOptions = !!flowPageOptions ? flowPageOptions : "{}"
	flowSiteOptions = !!flowSiteOptions ? flowSiteOptions : "{}"
	
	flowPageOptions = eval("(" + flowPageOptions + ")")
	flowSiteOptions = eval("(" + flowSiteOptions + ")")
	
	let flowOptions = {...flowSiteOptions, ...flowPageOptions}; 
	$("[id^=flow_]").flowChart(flowOptions);
	</script>









<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-75123653-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-75123653-1');
</script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-3S3FFW5PH3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3S3FFW5PH3');
</script><script id="baidu_analytics">
	  var _hmt = _hmt || [];
	  (function() {
		if (window.location.hostname === 'localhost') return;
		var hm = document.createElement("script"); hm.async = true;
		hm.src = "https://hm.baidu.com/hm.js?cabc0a71f63da092412d82d1aefe7d1c";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hm, s);
	  })();
	</script>


	<script id="baidu_push">
	  (function(){
		if (window.location.hostname === 'localhost') return;
		var bp = document.createElement('script'); bp.async = true;
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
		  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
		  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	  })();
	</script>


<script>
  let copyIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
  <path fill-rule="evenodd" 
  d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 
      5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/>
</svg>`;
  let copiedIcon=`<svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path d="m2.25 12.321 7.27 6.491c.143.127.321.19.499.19.206 0 .41-.084.559-.249l11.23-12.501c.129-.143.192-.321.192-.5 0-.419-.338-.75-.749-.75-.206 0-.411.084-.559.249l-10.731 11.945-6.711-5.994c-.144-.127-.322-.19-.5-.19-.417 0-.75.336-.75.749 0 .206.084.412.25.56" fill-rule="nonzero"/></svg>`;
  function createCopyButton(codeDiv) {
    const div = document.createElement("div");
    div.className = "copy-code";
    div.innerHTML = copyIcon;
    div.addEventListener("click", () =>
      copyCodeToClipboard(div, codeDiv)
    );
    addCopyButtonToDom(div, codeDiv);
  }

  async function copyCodeToClipboard(button, codeDiv) {
    console.log(codeDiv);
    const codeToCopy = codeDiv.querySelector(":scope > code")
      .innerText;
    await navigator.clipboard.writeText(codeToCopy);
    button.blur();
    
	button.innerHTML = copiedIcon;
    setTimeout(() => button.innerHTML = copyIcon, 2000);
  }

  function addCopyButtonToDom(button, codeDiv) {
    codeDiv.insertBefore(button, codeDiv.firstChild);
    const wrapper = document.createElement("div");
    wrapper.className = "highlight-wrapper";
    codeDiv.parentNode.insertBefore(wrapper, codeDiv);
    wrapper.appendChild(codeDiv);
  }

  var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  if(!isMobile){
     document.querySelectorAll("pre[class*=language]").forEach((codeDiv) => createCopyButton(codeDiv));
  }
</script>  




  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/components/prism-core.min.js" integrity="sha512-9khQRAUBYEJDCDVP2yw3LRUQvjJ0Pjx0EShmaQjcHa6AXiOv6qHQu9lCAIR8O+/D8FtaCoJ2c0Tf9Xo7hYH01Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-fTl/qcO1VgvKtOMApX2PdZzkziyr2stM65GYPLGuYMnuMm1z2JLJG6XVU7C/mR+E7xBUqCivykuhlzfqxXBXbg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-highlight/prism-line-highlight.min.js" integrity="sha512-sXBpWttHfaxTNfMdM4N1gfeIc01bFaKVrPdaECaHxNQy1QOAOt1R6HVcpPyPtwIr5pAsfa7eIg+DQIHzIODh8Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/plugins/line-numbers/prism-line-numbers.min.js" integrity="sha512-BttltKXFyWnGZQcRWj6osIg7lbizJchuAMotOkdLxHxwt/Hyo+cl47bZU0QADg+Qt5DJwni3SbYGXeGMB5cBcw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</body>
</html>
