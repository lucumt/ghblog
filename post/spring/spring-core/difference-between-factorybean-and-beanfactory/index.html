<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Spring中BeanFactory和FactoryBean的区别以及使用场景 - 飞狐的部落格</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Rosen Lu" /><meta name="description" content="简要叙述Spring中BeanFactory和FactoryBean的区别以及使用场景" /><meta name="keywords" content="Spring, BeanFactory, FactoryBean, 区别, 使用场景" />






<meta name="generator" content="Hugo 0.100.2 with theme even" />


<link rel="canonical" href="https://lucumt.info/post/spring/spring-core/difference-between-factorybean-and-beanfactory/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.42582d13b483cd0f7dec049cf819eefca048379b10708ab4de86a139d1b963a1.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="Spring中BeanFactory和FactoryBean的区别以及使用场景" />
<meta property="og:description" content="简要叙述Spring中BeanFactory和FactoryBean的区别以及使用场景" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lucumt.info/post/spring/spring-core/difference-between-factorybean-and-beanfactory/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-16T11:00:01+08:00" />
<meta property="article:modified_time" content="2022-01-16T11:00:01+08:00" />

<meta itemprop="name" content="Spring中BeanFactory和FactoryBean的区别以及使用场景">
<meta itemprop="description" content="简要叙述Spring中BeanFactory和FactoryBean的区别以及使用场景"><meta itemprop="datePublished" content="2022-01-16T11:00:01+08:00" />
<meta itemprop="dateModified" content="2022-01-16T11:00:01+08:00" />
<meta itemprop="wordCount" content="3319">
<meta itemprop="keywords" content="Spring," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring中BeanFactory和FactoryBean的区别以及使用场景"/>
<meta name="twitter:description" content="简要叙述Spring中BeanFactory和FactoryBean的区别以及使用场景"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>

  
	  
	  
	  <a href="https://github.com/lucumt/ghblog" title="https://github.com/lucumt/ghblog" target="_blank">  
	  <img style="position: fixed; top: 0; right: 0; border: 0; z-index:9999;" 
		 src="/blog_img/forkme_right_gray.png" 
		 alt="Fork me on GitHub">
	  </a>
  


  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Rosen&#39;s World</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于我</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Rosen&#39;s World</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于我</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Spring中BeanFactory和FactoryBean的区别以及使用场景</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-01-16 </span>
        <div class="post-category">
            <a href="/categories/spring%E7%B3%BB%E5%88%97/"> Spring系列 </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#组件说明">组件说明</a>
      <ul>
        <li><a href="#beanfactory">BeanFactory</a></li>
        <li><a href="#factorybean">FactoryBean</a></li>
        <li><a href="#使用示例">使用示例</a></li>
      </ul>
    </li>
    <li><a href="#二者之间的区别">二者之间的区别</a></li>
    <li><a href="#相关使用场景">相关使用场景</a></li>
    <li><a href="#参考文档">参考文档</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/BeanFactory.html"><strong>BeanFactory</strong></a>和<a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/FactoryBean.html"><strong>FactoryBean</strong></a>的区别与使用场景是<a href="https://spring.io/"><strong>Spring</strong></a>面试中的高频题之一，本文基于网上资料和个人理解，简要说明他们之间的异同以及使用场景。</p>
<h1 id="组件说明">组件说明</h1>
<h2 id="beanfactory">BeanFactory</h2>
<p>在<code>BeanFactory</code>的API中，一开始就有如下一句描述</p>
<blockquote>
<p>The root interface for accessing a Spring bean container</p>
</blockquote>
<p>这句话指明了<code>BeanFactory</code>在<code>Spring</code>家族中的地位，它是<strong>操作<code>Spring</code>容器、获取<code>Spring</code> Bean的根接口</strong>。从字面意思可以看出它是一个Bean工厂，其内部采用了工厂模式，通过它们我们可进行创建Bean、获取Bean等操作<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>。</p>
<p>在学习与使用<code>Spring</code>过程中接触到的<code>ApplicaitonContext</code>、<code>AnnotationConfigApplicastionContext</code>、<code>ClassPathXmlApplicationContext</code>等都是其子接口和具体的实现类，它是我们在<code>Spring</code>框架中接触最多的系统接口，下图中的UML展示了<code>BeanFactory</code>及其子接口和实现类之间的关系<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p><img src="/blog_img/spring/difference-between-factorybean-and-beanfactory/bean-factory-uml-1.png" alt="BeanFactory UML类图" title="BeanFactory UML类图"></p>
<p>下述代码展示了<code>BeanFactory</code>所包含的全部15个接口方法，它们涵盖了<code>Spring</code>中对Bean对象的各种读取操作，若经常使用<code>Spring</code>这些接口方法看起来就会很熟悉。</p>
<details>
  <summary><mark><font color=darkred>BeanFactory接口(点击可展开)</font></mark></summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BeanFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">String</span> <span class="n">FACTORY_BEAN_PREFIX</span> <span class="o">=</span> <span class="s">&#34;&amp;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">	<span class="n">Object</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">BeansException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">requiredType</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">BeansException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Object</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">BeansException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">requiredType</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">BeansException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">requiredType</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">BeansException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">ObjectProvider</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getBeanProvider</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">requiredType</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">ObjectProvider</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getBeanProvider</span><span class="o">(</span><span class="n">ResolvableType</span> <span class="n">requiredType</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">boolean</span> <span class="nf">containsBean</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">boolean</span> <span class="nf">isSingleton</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoSuchBeanDefinitionException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">	<span class="kt">boolean</span> <span class="nf">isPrototype</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoSuchBeanDefinitionException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">	<span class="kt">boolean</span> <span class="nf">isTypeMatch</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">ResolvableType</span> <span class="n">typeToMatch</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoSuchBeanDefinitionException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">boolean</span> <span class="nf">isTypeMatch</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">typeToMatch</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoSuchBeanDefinitionException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@Nullable</span>
</span></span><span class="line"><span class="cl">	<span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getType</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoSuchBeanDefinitionException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">	<span class="nd">@Nullable</span>
</span></span><span class="line"><span class="cl">	<span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getType</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">allowFactoryBeanInit</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NoSuchBeanDefinitionException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">String</span><span class="o">[]</span> <span class="nf">getAliases</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<p>由于<code>BeanFactory</code>是操作<code>Spring</code>容器和对象的根接口，<code>Spring</code>官方要求它尽可能的支持Bean生命周期的各种接口，基于<code>Spring</code>官方API的描述，其完整的方法链和顺序如下：</p>
<ol>
<li>BeanNameAware&rsquo;s <code>setBeanName</code></li>
<li>BeanClassLoaderAware&rsquo;s <code>setBeanClassLoader</code></li>
<li>BeanFactoryAware&rsquo;s <code>setBeanFactory</code></li>
<li>EnvironmentAware&rsquo;s <code>setEnvironment</code></li>
<li>EmbeddedValueResolverAware&rsquo;s <code>setEmbeddedValueResolver</code></li>
<li>ResourceLoaderAware&rsquo;s <code>setResourceLoader</code> (only applicable when running in an application context)</li>
<li>ApplicationEventPublisherAware&rsquo;s <code>setApplicationEventPublisher</code> (only applicable when running in an application context)</li>
<li>MessageSourceAware&rsquo;s <code>setMessageSource</code> (only applicable when running in an application context)</li>
<li>ApplicationContextAware&rsquo;s <code>setApplicationContext</code> (only applicable when running in an application context)</li>
<li>ServletContextAware&rsquo;s <code>setServletContext</code> (only applicable when running in a web application context)</li>
<li><code>postProcessBeforeInitialization</code> methods of BeanPostProcessors</li>
<li>InitializingBean&rsquo;s <code>afterPropertiesSet</code></li>
<li>a custom <code>init-method</code> definition</li>
<li><code>postProcessAfterInitialization</code> methods of BeanPostProcessors</li>
</ol>
<p>上述初始化链可很好的帮我们回答面试中另外几个常见的问题：</p>
<ul>
<li><code>Spring</code>中Bean如何初始化</li>
<li>描述<code>Spring</code>中Bean的生命周期</li>
</ul>
<h2 id="factorybean">FactoryBean</h2>
<p><code>FactoryBean</code>从名字就能看出来是一个Bean，但不是普通的Bean，否则<code>Spring</code>作者为啥要单独的创建这个接口呢？<code>FactoryBean</code>也是一个接口，其源码如下，从中可以看出该接口只有3个方法，与<code>BeanFactory</code>相比数量大为减少，同时这3个接口方法的作用也同<code>BeanFactory</code>中的相关方法类似。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">FactoryBean</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">String</span> <span class="n">OBJECT_TYPE_ATTRIBUTE</span> <span class="o">=</span> <span class="s">&#34;factoryBeanObjectType&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@Nullable</span>
</span></span><span class="line"><span class="cl">	<span class="n">T</span> <span class="nf">getObject</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@Nullable</span>
</span></span><span class="line"><span class="cl">	<span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getObjectType</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">default</span> <span class="kt">boolean</span> <span class="nf">isSingleton</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过上述代码能够获取的信息依旧有限，在<code>FactoryBean</code>的官方API中有如下描述</p>
<blockquote>
<p>Interface to be implemented by objects used within a <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/BeanFactory.html"><code>BeanFactory</code></a> which are themselves factories for individual objects. If a bean implements this interface, it is used as a factory for an object to expose, not directly as a bean instance that will be exposed itself.</p>
<p><strong>NB: A bean that implements this interface cannot be used as a normal bean.</strong> A FactoryBean is defined in a bean style, but the object exposed for bean references (<a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/FactoryBean.html#getObject--"><code>getObject()</code></a>) is always the object that it creates.</p>
</blockquote>
<p>上述文档的主要结论如下：</p>
<ul>
<li><code>FactoryBean</code>不是一个普通的Bean，它实际上是一个用于创建特定bean的工厂</li>
<li>通过实现<code>FactoryBean</code>接口，可通过暴露对象的方式创建特定bean对象，而这个bean对象本身不会暴露</li>
</ul>
<p>到这里虽然二者的区别清楚了，但是<code>FactoryBean</code>的使用场景还是不清晰，在<a href="https://spring.io/blog/2011/08/09/what-s-a-factorybean"><strong>https://spring.io/blog/2011/08/09/what-s-a-factorybean</strong></a>这篇文章中，<code>Spring</code>的作者之一<a href="https://spring.io/team/joshlong"><strong>JOSH LONG</strong></a>用如下文字阐述了<code>FactoryBean</code>的使用场景</p>
<blockquote>
<p>A <code>FactoryBean</code> is a pattern to encapsulate interesting object construction logic in a class. It might be used, for example, to encode the construction of a complex object graph in a reusable way. Often this is used to construct complex objects that have many dependencies. It might also be used when the construction logic itself is highly volatile and depends on the configuration. A <code>FactoryBean</code> is also useful to help Spring construct objects that it couldn’t easily construct itself.</p>
</blockquote>
<p>从上述文字中可以看出<code>FactoryBean</code>主要<strong>用于构建一些实例化过程较为复杂或有配置依赖的对象(即非普通POJO)，并将其交给<code>Spring</code>容器管理</strong>。</p>
<p><code>Spring</code>框架本身就自带了实现<code>FactoryBean</code>的70多个接口，如<code>ProxyFactoryBean</code>、<code>MapFactoryBean</code>、<code>PropertiesFactoryBean</code>等，从个人角度来看它们要么理解起来较为复杂，要么使用较少不具有代表性，下面以<code>MyBatis-Spring</code>中的<a href="https://github.com/mybatis/spring/blob/master/src/main/java/org/mybatis/spring/SqlSessionFactoryBean.java"><strong>SqlSessionFactoryBean</strong></a>为例来了解其用法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">SqlSessionFactory</span> <span class="nf">getObject</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">sqlSessionFactory</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">afterPropertiesSet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">sqlSessionFactory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 参数校验与对象创建
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterPropertiesSet</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">notNull</span><span class="o">(</span><span class="n">dataSource</span><span class="o">,</span> <span class="s">&#34;Property &#39;dataSource&#39; is required&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">notNull</span><span class="o">(</span><span class="n">sqlSessionFactoryBuilder</span><span class="o">,</span> <span class="s">&#34;Property &#39;sqlSessionFactoryBuilder&#39; is required&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">state</span><span class="o">((</span><span class="n">configuration</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">configLocation</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">||</span> <span class="o">!(</span><span class="n">configuration</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">configLocation</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;Property &#39;configuration&#39; and &#39;configLocation&#39; can not specified with together&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">sqlSessionFactory</span> <span class="o">=</span> <span class="n">buildSqlSessionFactory</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 基于配置文件创建具体的SqlSessionFactory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">protected</span> <span class="n">SqlSessionFactory</span> <span class="nf">buildSqlSessionFactory</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 各种检查代码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">sqlSessionFactoryBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="n">targetConfiguration</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在创建<code>SqlSessionFactory</code>时需要依赖数据库的配置等一些配置信息，但这些配置信息若通过<code>BeanFactory</code>以传统的<strong>实例化</strong>-&gt;<strong>初始化</strong>的方式创建时是很难办到的，虽然可以通过<code>BeanPostProcessors</code>的接口中的回调方法来实现，但会导致代码复杂并且不能满足某些特殊场景下的需求，而通过<code>FactoryBean</code>我们只需要根据实际业务逻辑在<code>getObject()</code>方法中创建对应的对象并返回即可，由于对象的创建由我们自己把控，在达到代码简洁的同时，创建的对象也能被<code>Spring</code>容器管理。</p>
<h2 id="使用示例">使用示例</h2>
<p>假设有如下所示的Group类</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Group</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">groupName</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// getter setter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在使用<code>BeanFactory</code>获取对象的方法如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">AnnotationConfigApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">AppConfig</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Group</span> <span class="n">group</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">Group</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">group</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出结果为Group@25d250c6，可以看到已经正确的获取到了Bean对象。</p>
<p>定义一个实现了<code>FactoryBean</code>接口的GroupFactoryBean，其代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GroupFactoryBean</span> <span class="kd">implements</span> <span class="n">FactoryBean</span><span class="o">&lt;</span><span class="n">Group</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Group</span> <span class="nf">getObject</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">Group</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">getObjectType</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Group</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>测试代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">AnnotationConfigApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">GroupFactoryBean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Object</span> <span class="n">object</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;groupFactoryBean&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出结果为Group@fdefd3f，如前面通过<code>BeanFactory</code> 创建的对象类似，接下来将<strong>groupFactoryBean</strong>添加一个<code>&amp;</code>前缀，变为<code>&amp;groupFactoryBean</code>后再次进行测试</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">AnnotationConfigApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">GroupFactoryBean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Object</span> <span class="n">object</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;&amp;groupFactoryBean&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">object</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出结果为GroupFactoryBean@1990a65e，由此可得出如下结论 ：</p>
<ul>
<li>当直接通过<code>FactoryBean</code>实现类的接口名称获取对象时，得到的是该<code>FactoryBean</code>实现类中创建的对象本身，也是我们正常的使用方式</li>
<li>当在<code>FactoryBean</code>接口对象名前面加上<code>&amp;</code>前缀时，得到的是<code>FactoryBean</code>实现类本身，一般用于调试分析。</li>
</ul>
<h1 id="二者之间的区别">二者之间的区别</h1>
<ul>
<li>相同点：
<ul>
<li>都是接口类，需要使用者自己实现相应的方法</li>
<li>接口中创建bean对象都能被<code>Spring</code>容器管理</li>
</ul>
</li>
<li>不同点:
<ul>
<li><code>BeanFactory</code>提供的接口方法更多，更具有灵活性，如能获取别名、bean对象类型等</li>
<li><code>BeanFactory</code>基于<code>Spring</code>规范实现，其创建的bean会在<code>Spring</code>容器中经历完整的生命周期，能够调用<code>@PostConstruct</code>、<code>BeanPostProcessors</code>等接口和方法</li>
<li><code>Spring</code>容器只负责<code>FactoryBean</code>创建的bean对象的生命周期管理，不负责bean对象的创建和销毁(因为由我们自己实现了嘛!)，所以调用<code>@PostConstruct</code>和<code>@PreDestroy</code>方法不会生效，需要实现<code>DisposableBean</code>等接口来达到该目的</li>
</ul>
</li>
</ul>
<h1 id="相关使用场景">相关使用场景</h1>
<ul>
<li><strong><code>BeanFactory</code></strong>:
<ul>
<li>项目中各种常规的<code>POJO</code>、<code>Dao</code>、<code>Service</code>等不涉及复杂构造的场景</li>
</ul>
</li>
<li><strong><code>FactoryBean</code></strong>:
<ul>
<li>对象的构造(实例化)较为复杂，通常是系统中的一些底层组件，如<code>SqlSessionFactoryBean</code>、<code>ProxyFactoryBean</code>等</li>
</ul>
</li>
</ul>
<h1 id="参考文档">参考文档</h1>
<ul>
<li>
<p><a href="https://www.cnblogs.com/aspirant/p/9082858.html">https://www.cnblogs.com/aspirant/p/9082858.html</a></p>
</li>
<li>
<p><a href="https://spring.io/blog/2011/08/09/what-s-a-factorybean">https://spring.io/blog/2011/08/09/what-s-a-factorybean</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/FactoryBean.html">https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/FactoryBean.html</a></p>
</li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>实际上Bean的创建、销毁都是由容器来负责的，使用时更多关注的是Bean对象的配置以及如何获取Bean对象&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>出于篇幅的考虑，实际上这张UML类图展示的并不完整，可在IDEA中基于<code>BeanFactory</code>自己生成完整的UML图&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/spring/">Spring</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/web/convert-folder-upload-data-to-tree-node-in-chrome/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">在Chrome中将上传的文件夹数据转化为按树结构展示</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/mybatis/insert-json-data-in-mybatis/">
            <span class="next-text nav-default">MyBatis中插入JSON格式数据</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:lucumt@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/3176419" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://www.linkedin.com/in/%E8%BF%90%E5%BC%BA-%E5%8D%A2-50a08bb5/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/lucumt" class="iconfont icon-github" title="github"></a>
  <a href="https://lucumt.info/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2016 - 
    2022<span class="heart"><i class="iconfont icon-heart"></i></span><span>Rosen Lu</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top" title="回到顶部">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.191509a5c8442abdb6eb5020a332fd59bdd83a7e78a2d2241108df9113504292.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-75123653-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-75123653-1');
</script><script id="baidu_analytics">
	  var _hmt = _hmt || [];
	  (function() {
		if (window.location.hostname === 'localhost') return;
		var hm = document.createElement("script"); hm.async = true;
		hm.src = "https://hm.baidu.com/hm.js?cabc0a71f63da092412d82d1aefe7d1c";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hm, s);
	  })();
	</script>


	<script id="baidu_push">
	  (function(){
		if (window.location.hostname === 'localhost') return;
		var bp = document.createElement('script'); bp.async = true;
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
		  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
		  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	  })();
	</script>


</body>
</html>
