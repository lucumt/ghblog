<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>一次由wait造成的死锁问题分析 - 飞狐的部落格</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Rosen Lu" /><meta name="description" content="记录java多线程编程中一次由wait造成的死锁问题分析，给自己和相关人员提供总结与参考" /><meta name="keywords" content="java,multiple-threads,deadlock" />
<meta name="generator" content="Hugo0.126.1with theme even" />


<link rel="canonical" href="https://lucumt.info/post/java-concurrency/analysis-deadlock-in-multiple-threads-caused-by-wait/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="/sass/main.min.e40488554eb62dbd93e56cb3183d65b327bc5bf44f76e5c2f6e9f7e602e619a8.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet"><meta property="og:url" content="https://lucumt.info/post/java-concurrency/analysis-deadlock-in-multiple-threads-caused-by-wait/">
  <meta property="og:site_name" content="飞狐的部落格">
  <meta property="og:title" content="一次由wait造成的死锁问题分析">
  <meta property="og:description" content="记录java多线程编程中一次由wait造成的死锁问题分析，给自己和相关人员提供总结与参考">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2020-09-12T18:07:27+08:00">
    <meta property="article:modified_time" content="2020-09-12T18:07:27+08:00">
    <meta property="article:tag" content="Java">
    <meta property="article:tag" content="Java Concurrency">

  <meta itemprop="name" content="一次由wait造成的死锁问题分析">
  <meta itemprop="description" content="记录java多线程编程中一次由wait造成的死锁问题分析，给自己和相关人员提供总结与参考">
  <meta itemprop="datePublished" content="2020-09-12T18:07:27+08:00">
  <meta itemprop="dateModified" content="2020-09-12T18:07:27+08:00">
  <meta itemprop="wordCount" content="1630">
  <meta itemprop="keywords" content="java,multiple-threads,deadlock">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="一次由wait造成的死锁问题分析">
  <meta name="twitter:description" content="记录java多线程编程中一次由wait造成的死锁问题分析，给自己和相关人员提供总结与参考">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]--><link href="/lib/prism-1.29.0/themes/prism-solarizedlight.min.css" rel="stylesheet">
<link href="/lib/prism-1.29.0/plugins/line-highlight/prism-line-highlight.min.css" rel="stylesheet">
<link href="/lib/prism-1.29.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">
</head>
<body>
	  
	  <a href="https://github.com/lucumt/ghblog" title="https://github.com/lucumt/ghblog" target="_blank">  
	  <img style="position: fixed; top: 0; right: 0; border: 0; z-index:9999;" 
		 src="/blog_img/forkme_right_gray.png" 
		 alt="Fork me on GitHub">
	  </a><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Rosen&#39;s World</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于我</li>
      </a><a href="https://tech.lucumt.info">
        <li class="mobile-menu-item">外链</li>
      </a><a href="/search/">
        <li class="mobile-menu-item">搜索</li>
      </a>
  </ul>

  


</nav>
<div class="container" id="mobile-panel"><header id="header" class="header"><div class="logo-wrapper">
  <a href="/" class="logo">Rosen&#39;s World</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于我</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://tech.lucumt.info">外链</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/search/">搜索</a>
      </li>
  </ul>
</nav>

    </header><main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">一次由wait造成的死锁问题分析</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-09-12 </span>
        <div class="post-category">
            <a href="/categories/java%E7%BC%96%E7%A8%8B/"> Java编程 </a>
            </div>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#原始代码">原始代码</a></li>
        <li><a href="#执行结果状态查看">执行结果&amp;状态查看</a></li>
        <li><a href="#原因分析">原因分析</a></li>
        <li><a href="#改进代码">改进代码</a>
          <ul>
            <li><a href="#消除死循环">消除死循环</a></li>
            <li><a href="#实现轮流打印">实现轮流打印</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
	 
	  	
	
    <div class="post-content image-border">
	 <p>在<a href="/post/java-concurrency/print-a-b-c-in-turn-by-threads/">多种方式实现在Java中用线程轮流打印ABC</a>中自己本想用单个锁通过调用<code>wait()</code>实现轮流打印，但一直遇到全部等待并停止执行的死锁问题，经过网上求助和自己分析，最终找到问题原因，简单记录下。</p>
<h2 id="原始代码">原始代码</h2>
<pre class="line-numbers language-java " title="java">
<code>public class ThreadPrint4Test {

    public static void main(String[] args) {
        new ThreadPrint4Test().testPrint();
    }

    public void testPrint() {
        Object lock = new Object();
        new Thread(new PrintThread(&#34;A&#34;,lock),&#34;thread-A&#34;).start();
        new Thread(new PrintThread(&#34;B&#34;,lock),&#34;thread-B&#34;).start();
        new Thread(new PrintThread(&#34;C&#34;,lock),&#34;thread-C&#34;).start();
        try {
            TimeUnit.SECONDS.sleep(1);
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
        new Thread(() -&gt; {
            synchronized (lock) {
                lock.notifyAll();
            }
        }).start();
    }

    class PrintThread implements Runnable {

        private Object lock;
        private String value;

        public PrintThread(String value, Object lock) {
            this.value = value;
            this.lock = lock;
        }

        public void run() {
            while (true) {
                try {
                    synchronized (lock) {
                        lock.wait();
                        System.out.println(LocalTime.now() &#43; &#34;\t&#34; &#43; value);
                        lock.notifyAll();
                    }
                } catch (InterruptedException e) {
                    throw new RuntimeException(e);
                }
            }
        }
    }
}</code>
</pre><h2 id="执行结果状态查看">执行结果&amp;状态查看</h2>
<p>运行上述程序，可发现在输出若干字符后，程序处于阻塞状态，输出停止：</p>
<p><img src="/blog_img/java-concurrency/analysis-deadlock-in-multiple-threads-caused-by-wait/all-threads-stopped-print-characters.png" alt="程序停止输出" title="程序停止输出"></p>
<p>利用<code>jps</code>和<code>jstack</code>命令查看，可发现3个进程都处于<code>WAITING</code>状态形成类似死锁的现象，由此导致程序停止输出。</p>
<p><img src="/blog_img/java-concurrency/analysis-deadlock-in-multiple-threads-caused-by-wait/all-threads-are-waiting-for-awake.png" alt="线程都处于等待状态" title="线程都处于等待状态"></p>
<p>由于多次运行上述代码，均能出现此问题(只不过出现的时间间隔不同)，可知程序代码肯定编写不正确。</p>
<h2 id="原因分析">原因分析</h2>
<p>最开始检查代码时看起来一切正常:</p>
<ol>
<li>某线程首先通过<code>wait()</code>进入等待状态</li>
<li>只有被唤醒后才能继续往下执行输出代码</li>
<li>输出完毕后通过<code>notifyAll()</code></li>
<li>被<code>notifyAll()</code>唤醒的线程从步骤2开始往下执行</li>
<li>之后该线程调用<code>wait()</code>进入等待状态，重复步骤1实现不间断的打印</li>
</ol>
<pre class="line-numbers language-java " title="java">
<code>public void run() {
    while (true) {
        try {
            synchronized (lock) {
                lock.wait();
                System.out.println(LocalTime.now() &#43; &#34;\t&#34; &#43; value);
                lock.notifyAll();
            }
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
    }
}</code>
</pre><p>上述推理与代码看起来很完美，无懈可击，但程序执行时就是每次都不能一直打印下去，肯定是自己的理解有问题。</p>
<p>为了便于定位问题，将<code>run()</code>方法修改为如下代码：</p>
<pre class="line-numbers language-java " title="java">
<code>public void run() {
    while (true) {
        try {
            synchronized (lock) {
                String name = Thread.currentThread().getName();
                System.out.println(name &#43; &#34;\t&#34; &#43; LocalTime.now() &#43; &#34;\t&#34; &#43; &#34; will invoke wait&#34;);
                lock.wait();
                System.out.println(name &#43; &#34;\t&#34; &#43; LocalTime.now() &#43; &#34;\t&#34; &#43; &#34; is notified&#34;);
                System.out.println(name &#43; &#34;\t&#34; &#43; LocalTime.now() &#43; &#34;\t&#34; &#43; value);
                lock.notifyAll();
            }
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
    }
  }
}</code>
</pre><p>之后多次重新执行该程序，执行结果类似如下：</p>
<p><img src="/blog_img/java-concurrency/analysis-deadlock-in-multiple-threads-caused-by-wait/all-threads-invoke-wait-method.png" alt="所有线程均调用wait方法" title="所有线程均调用wait方法"></p>
<p>从上图可以看出中无法找出具体的问题复现规律，查看<code>wait()</code>的<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait--">官方文档</a>，有如下说明</p>
<blockquote>
<p>The current thread must own this object&rsquo;s monitor. The thread releases ownership of this monitor and waits until another thread notifies threads waiting on this object&rsquo;s monitor to wake up either through a call to the <code>notify</code> method or the <code>notifyAll</code> method. The thread then waits until it can re-obtain ownership of the monitor and resumes execution.</p>
</blockquote>
<p>查看<code>notifyAll()</code>的<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#notifyAll--">官方文档</a>，有如下说明：</p>
<blockquote>
<p>The awakened threads will not be able to proceed until the current thread relinquishes the lock on this object. The awakened threads will compete in the usual manner with any other threads that might be actively competing to synchronize on this object;</p>
</blockquote>
<p>从上述说明中可获得如下信息：</p>
<ol>
<li>调用<code>wait()</code>方法后，程序会处于等待状态，同时释放锁</li>
<li>被<code>notifyAll()</code>唤醒的线程并不会立即执行，需要等当前调用<code>notifyAll()</code>的线程释放对应的锁</li>
<li>被<code>notfiyAll()</code>唤醒的线程需要与其它正在执行的线程一并去竞争获取锁，并没有区别对待</li>
</ol>
<p>至此，可以大致找出问题原因</p>
<blockquote>
<p>三个线程在某个时间段先后调用了<code>wait()</code>方法都进入了<code>WAITING</code>状态，同时没有其它线程来唤醒它们，导致最终程序停止输出。</p>
</blockquote>
<p>以线程A造成死锁为例，其过程如下:</p>
<ol>
<li>线程A调用<code>wait()</code>方法进入<code>WAITING</code>状态并释放锁</li>
<li>线程B获得锁，进入<code>synchronized</code>代码块</li>
<li>线程B执行<code>wait()</code>方法进行<code>WAITING</code>状态并释放锁</li>
<li>线程C获得锁，进入<code>synchronized</code>代码块</li>
<li>线程C执行<code>wait()</code>方法进行<code>WAITING</code>状态并释放锁</li>
<li>至此线程A、线程B、线程C均处于<code>WAITING</code>状态，程序停止输出</li>
</ol>
<p>图示说明如下：</p>
<p><img src="/blog_img/java-concurrency/analysis-deadlock-in-multiple-threads-caused-by-wait/multi-thread-deadlock-analysis.png" alt="分析图示1" title="分析图示"></p>
<h2 id="改进代码">改进代码</h2>
<p>找到问题原因后，要修复此问题也很容，只需要避免所有的线程同时调用<code>wait()</code>方法即可，可在调用<code>wait()</code>前加个判断，确保始终有一个线程不用进入<code>WAITING</code>状态，能够释放锁。</p>
<h3 id="消除死循环">消除死循环</h3>
<pre class="line-numbers language-java " title="java">
<code>public class ThreadPrint4Test {

    public static void main(String[] args) {
        new ThreadPrint4Test().testPrint();
    }

    private volatile String runThread;

    public void testPrint() {
        Object lock = new Object();
        new Thread(new PrintThread(&#34;A&#34;, lock), &#34;thread-A&#34;).start();
        new Thread(new PrintThread(&#34;B&#34;, lock), &#34;thread-B&#34;).start();
        new Thread(new PrintThread(&#34;C&#34;, lock), &#34;thread-C&#34;).start();
        try {
            TimeUnit.SECONDS.sleep(1);
        } catch (InterruptedException e) {
            throw new RuntimeException(e);
        }
        new Thread(() -&gt; {
            synchronized (lock) {
                lock.notifyAll();
            }
        }).start();
    }

    class PrintThread implements Runnable {

        private Object lock;
        private String value;

        public PrintThread(String value, Object lock) {
            this.value = value;
            this.lock = lock;
        }

        public void run() {
            while (true) {
                try {
                    synchronized (lock) {
                        boolean process = value.equals(runThread);
                        if (!process) {
                            lock.wait();
                            System.out.println(LocalTime.now() &#43; &#34;\t&#34; &#43; value);
                            runThread = value;
                        }
                        lock.notifyAll();
                    }
                } catch (InterruptedException e) {
                    throw new RuntimeException(e);
                }
            }
        }
    }
}</code>
</pre><h3 id="实现轮流打印">实现轮流打印</h3>
<pre class="line-numbers language-java " title="java">
<code>public class ThreadPrint4Test {

    public static void main(String[] args) {
        new ThreadPrint4Test().testPrint();
    }

    private volatile int count = 0;

    public void testPrint() {
        Object lock = new Object();
        new Thread(new PrintThread(&#34;A&#34;, lock), &#34;thread-A&#34;).start();
        new Thread(new PrintThread(&#34;B&#34;, lock), &#34;thread-B&#34;).start();
        new Thread(new PrintThread(&#34;C&#34;, lock), &#34;thread-C&#34;).start();
    }

    class PrintThread implements Runnable {

        private Object lock;
        private String value;

        public PrintThread(String value, Object lock) {
            this.value = value;
            this.lock = lock;
        }

        public void run() {
            while (true) {
                try {
                    synchronized (lock) {
                        boolean process = &#34;A&#34;.equals(value) &amp;&amp; count % 3 == 0;
                        if (process) {
                            count = 0;
                        }
                        process = process || (&#34;B&#34;.equals(value) &amp;&amp; count % 3 == 1);
                        process = process || (&#34;C&#34;.equals(value) &amp;&amp; count % 3 == 2);
                        if (process) {
                            lock.wait();
                            System.out.println(value);
                            count&#43;&#43;;
                            Thread.sleep(500);
                        }
                        lock.notifyAll();
                    }
                } catch (InterruptedException e) {
                    throw new RuntimeException(e);
                }
            }
        }

    }
}</code>
</pre>
    </div>

    
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/java/">Java</a>
          <a href="/tags/java-concurrency/">Java Concurrency</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/docker/difference-between-add-and-copy-in-dockerfile-build/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Dockerfile中ADD与COPY的使用异同</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/java-concurrency/print-a-b-c-in-turn-by-threads/">
            <span class="next-text nav-default">多种方式实现在Java中用线程轮流打印ABC</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://giscus.app/client.js"
            data-repo="lucumt/ghblog"
            data-repo-id="MDEwOlJlcG9zaXRvcnk0MTQ3MDEzOA=="
            data-category="General"
            data-category-id="DIC_kwDOAnjIus4CRN6c"
            data-mapping="pathname"
            data-strict="0"
            data-reactions-enabled="1"
            data-emit-metadata="0"
            data-input-position="top"
            data-theme="light"
            data-lang="en"
            data-loading="lazy"
            crossorigin="anonymous"
            async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/giscus/giscus">comments powered by giscus.</a></noscript>

      </div>
    </main>
	<footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:cumtlu@126.com" class="iconfont icon-email" title="email"></a>
      <a href="https://stackoverflow.com/users/3176419" class="iconfont icon-stack-overflow" title="stack-overflow"></a>
      <a href="https://www.linkedin.com/in/%E8%BF%90%E5%BC%BA-%E5%8D%A2-50a08bb5/" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/lucumt" class="iconfont icon-github" title="github"></a>
  <a href="" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2016 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span></span>
  </span>
</div>

    </footer><div class="back-to-top" id="back-to-top" title="回到顶部">
      <i class="iconfont icon-up"></i>
    </div>
  </div><script type="text/javascript" src="/lib/jquery/jquery-3.6.4.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script><script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script><script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-75123653-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-75123653-1');
</script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-3S3FFW5PH3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3S3FFW5PH3');
</script><script id="baidu_analytics">
	  var _hmt = _hmt || [];
	  (function() {
		if (window.location.hostname === 'localhost') return;
		var hm = document.createElement("script"); hm.async = true;
		hm.src = "https://hm.baidu.com/hm.js?cabc0a71f63da092412d82d1aefe7d1c";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hm, s);
	  })();
	</script>


	<script id="baidu_push">
	  (function(){
		if (window.location.hostname === 'localhost') return;
		var bp = document.createElement('script'); bp.async = true;
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https') {
		  bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else {
		  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	  })();
	</script>


<script>
  let copyIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
  <path fill-rule="evenodd" 
  d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 
      5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/>
</svg>`;
  let copiedIcon=`<svg clip-rule="evenodd" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
  <path d="m2.25 12.321 7.27 6.491c.143.127.321.19.499.19.206 0 .41-.084.559-.249l11.23-12.501c.129-.143.192-.321.192-.5 0-.419-.338-.75-.749-.75-.206 0-.411.084-.559.249l-10.731 11.945-6.711-5.994c-.144-.127-.322-.19-.5-.19-.417 0-.75.336-.75.749 0 .206.084.412.25.56" fill-rule="nonzero"/></svg>`;
  function createCopyButton(codeDiv) {
    const div = document.createElement("div");
    div.className = "copy-code";
    div.innerHTML = copyIcon;
    div.addEventListener("click", () =>
      copyCodeToClipboard(div, codeDiv)
    );
    addCopyButtonToDom(div, codeDiv);
  }

  async function copyCodeToClipboard(button, codeDiv) {
    const codeToCopy = codeDiv.querySelector(":scope > code")
      .innerText;
    await navigator.clipboard.writeText(codeToCopy);
    button.blur();
	button.innerHTML = copiedIcon;
    setTimeout(() => button.innerHTML = copyIcon, 2000);
  }

  function addCopyButtonToDom(button, codeDiv) {
    const wrapper = document.createElement("div");
    wrapper.className = "highlight-wrapper";
    codeDiv.parentNode.insertBefore(wrapper, codeDiv);
    wrapper.appendChild(codeDiv);
	wrapper.insertBefore(button, wrapper.firstChild);
  }

  var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  if(!isMobile){
     document.querySelectorAll("pre[class*=language]").forEach((codeDiv) => createCopyButton(codeDiv));
  }
</script>  




  <script type="text/javascript" src="/lib/prism-1.29.0/components/prism-core.min.js"></script>
  <script type="text/javascript" src="/lib/prism-1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script type="text/javascript" src="/lib/prism-1.29.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
  <script type="text/javascript" src="/lib/prism-1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
  
  <script type="text/javascript">
     document.addEventListener('DOMContentLoaded', initCodeTabs);
	 document.addEventListener('DOMContentLoaded', switchTabCodes);
	 function initCodeTabs(){
	     document.querySelectorAll('.codetabs').forEach(tab =>{
		    let tabHeader = tab.querySelector('.codetabs-header');
			let tabBody = tab.querySelector('.codetabs-body');
		    let codeblocks = tab.querySelectorAll('.codetabs-body > .highlight-wrapper');
			codeblocks.forEach((block,index) =>{
			   let titleContent = block.querySelector('pre').getAttribute('title');
			   let title = document.createElement('div');
			   title.classList.add('tab');
			   if(index == 0){
			   	  title.classList.add('active');
			   }
			   title.setAttribute('data-codetab',index);
			   title.appendChild(document.createTextNode(titleContent));
			   tabHeader.appendChild(title);
			   
			   let div = document.createElement('div');
			   div.classList.add('tab');
			   if(index == 0){
			   	  div.classList.add('active');
			   }
			   div.setAttribute('data-codetab',index);
			   div.appendChild(block);
			   tabBody.appendChild(div);
			});
		 });
	 }
	 function switchTabCodes(){
		 document.querySelectorAll('.codetabs  .codetabs-header > .tab').forEach(tab => {
			 tab.addEventListener('click', function() {
			      if(tab.classList.contains('active')){
					 return;
				  }
				  let tabId = tab.getAttribute('data-codetab');
				  let codetabs = tab.parentNode.parentNode;
				  
				  codetabs.querySelectorAll('.codetabs .tab.active').forEach(e => e.classList.remove('active'));
				  codetabs.querySelectorAll('.codetabs .tab[data-codetab="' + tabId + '"]').forEach(e => e.classList.add('active'));  
			 });
		 });
	 }
  </script>
</body>
</html>
